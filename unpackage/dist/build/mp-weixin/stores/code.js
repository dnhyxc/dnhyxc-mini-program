"use strict";const t=require("../common/vendor.js"),e=require("../server/index.js"),i=require("../constant/index.js"),a=t.defineStore("code",{state:()=>({pageNo:0,pageSize:20,total:0,loading:!1,codeList:[],detail:{},detailLoading:!1,html:""}),actions:{init(){this.pageNo=0,this.pageSize=20,this.total=0,this.codeList=[]},async getCodeList(t){try{if(0!==this.codeList.length&&this.codeList.length>=this.total)return;this.pageNo=this.pageNo+1,this.loading=!0;const a=await e.request({url:`${i.apiUrl}/getCodeListByMiniProgram`,data:{pageNo:this.pageNo,pageSize:this.pageSize,keyword:t,all:!0}});this.loading=!1,(null==a?void 0:a.success)&&(this.total=a.data.total,this.codeList=[...this.codeList,...a.data.list])}catch{this.loading=!1}},async getCodeById(a){try{this.detailLoading=!0;const s=await e.request({url:`${i.apiUrl}/getCodeByIdByMiniProgram`,data:{id:a}});if(this.detailLoading=!1,s.success){this.detail=s.data;const a=await e.request({url:`${i.apiUrl}/md2html`,data:{content:`\`\`\`${s.data.language}\n${s.data.content}\n\`\`\``,options:{needKatex:!1,lineNumber:!0}}});if(a.success){const e=t.sanitizeHtml(a.data,{allowedTags:!1,transformTags:{iframe:"div",script:"p"},allowedAttributes:!1,allowVulnerableTags:!0});this.detailLoading=!1,this.html=e}else this.html=""}}catch{this.detailLoading=!1}}}});exports.useCodeStore=a;
