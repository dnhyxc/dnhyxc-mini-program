{"version":3,"file":"index.js","sources":["stores/index.ts"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport { request } from '../server'\r\nimport sanitizeHtml from 'sanitize-html';\r\nimport { ArticleItem } from '../typings/index'\r\n\r\ninterface IProps {\r\n\tpageNo : number,\r\n\tpageSize : number,\r\n\ttotal : number,\r\n\tloading : boolean,\r\n\tarticleList : ArticleItem[],\r\n\tdetail : Omit<ArticleItem, 'id'>,\r\n\tdetailLoading : boolean,\r\n\thtml : string\r\n}\r\n\r\nconst url = 'http://localhost:9112/api'\r\n// const url = 'https://www.dnhyxc.cn/api'\r\n\r\nexport const useArticleStore = defineStore('article', {\r\n\tstate: () : IProps => ({\r\n\t\tpageNo: 0,\r\n\t\tpageSize: 20,\r\n\t\ttotal: 0,\r\n\t\tloading: false,\r\n\t\tarticleList: [],\r\n\t\tdetail: {},\r\n\t\tdetailLoading: false,\r\n\t\thtml: ''\r\n\t}),\r\n\tactions: {\r\n\t\tinit() {\r\n\t\t\tthis.pageNo = 0\r\n\t\t\tthis.pageSize = 20\r\n\t\t\tthis.total = 0\r\n\t\t\tthis.articleList = []\r\n\t\t},\r\n\t\tasync getArticleList() {\r\n\t\t\ttry {\r\n\t\t\t\tif (this.articleList.length !== 0 && this.articleList.length >= this.total) return;\r\n\t\t\t\tthis.pageNo = this.pageNo + 1;\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tconst res = await request<{ data : { list : ArticleItem[], total : number }, success : boolean }>({\r\n\t\t\t\t\turl: `${url}/articleList`,\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tpageNo: this.pageNo,\r\n\t\t\t\t\t\tpageSize: this.pageSize\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t\tif (res?.success) {\r\n\t\t\t\t\tthis.total = res.data.total;\r\n\t\t\t\t\tthis.articleList = [...this.articleList, ...res.data.list];\r\n\t\t\t\t}\r\n\t\t\t} catch {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync getDetail(id : string) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.detailLoading = true;\r\n\t\t\t\tconst res = await request<{ data : ArticleItem, success : boolean }>({\r\n\t\t\t\t\turl: `${url}/articleDetail`,\r\n\t\t\t\t\t// url: 'https://www.dnhyxc.cn/api/articleDetail',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.detail = res.data\r\n\t\t\t\tif (res.success) {\r\n\t\t\t\t\tconst result = await request<{ data : string, success : boolean }>({\r\n\t\t\t\t\t\turl: `${url}/md2html`,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tcontent: res.data.content,\r\n\t\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t\tneedKatex: false, // 是否需要转译数学公式\r\n\t\t\t\t\t\t\t\tlineNumber: true // 是否开启代码块行号\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\tconst cleanHtml = sanitizeHtml(result.data, {\r\n\t\t\t\t\t\t\tallowedTags: false,\r\n\t\t\t\t\t\t\ttransformTags: {\r\n\t\t\t\t\t\t\t\tiframe: 'div',\r\n\t\t\t\t\t\t\t\tscript: 'p',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tallowedAttributes: false,\r\n\t\t\t\t\t\t\tallowVulnerableTags: true, // 明确允许危险标签\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.detailLoading = false;\r\n\t\t\t\t\t\tthis.html = cleanHtml\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.html = ''\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch {\r\n\t\t\t\tthis.detailLoading = false\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tgetters: {\r\n\t\t// audios: (state) => state.audios,\r\n\t\t// audioKeys: (state) => state.audioKeys\r\n\t},\r\n});"],"names":["defineStore","request","sanitizeHtml"],"mappings":";;;AAgBA,MAAM,MAAM;AAGC,MAAA,kBAAkBA,0BAAY,WAAW;AAAA,EACrD,OAAO,OAAgB;AAAA,IACtB,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,OAAO;AAAA,IACP,SAAS;AAAA,IACT,aAAa,CAAC;AAAA,IACd,QAAQ,CAAC;AAAA,IACT,eAAe;AAAA,IACf,MAAM;AAAA,EAAA;AAAA,EAEP,SAAS;AAAA,IACR,OAAO;AACN,WAAK,SAAS;AACd,WAAK,WAAW;AAChB,WAAK,QAAQ;AACb,WAAK,cAAc;IACpB;AAAA,IACA,MAAM,iBAAiB;AAClB,UAAA;AACH,YAAI,KAAK,YAAY,WAAW,KAAK,KAAK,YAAY,UAAU,KAAK;AAAO;AACvE,aAAA,SAAS,KAAK,SAAS;AAC5B,aAAK,UAAU;AACT,cAAA,MAAM,MAAMC,qBAAgF;AAAA,UACjG,KAAK,GAAG,GAAG;AAAA,UACX,MAAM;AAAA,YACL,QAAQ,KAAK;AAAA,YACb,UAAU,KAAK;AAAA,UAChB;AAAA,QAAA,CACA;AACD,aAAK,UAAU;AACf,YAAI,2BAAK,SAAS;AACZ,eAAA,QAAQ,IAAI,KAAK;AACjB,eAAA,cAAc,CAAC,GAAG,KAAK,aAAa,GAAG,IAAI,KAAK,IAAI;AAAA,QAC1D;AAAA,MAAA,QACO;AACP,aAAK,UAAU;AAAA,MAChB;AAAA,IACD;AAAA,IACA,MAAM,UAAU,IAAa;AACxB,UAAA;AACH,aAAK,gBAAgB;AACf,cAAA,MAAM,MAAMA,qBAAmD;AAAA,UACpE,KAAK,GAAG,GAAG;AAAA;AAAA,UAEX,MAAM;AAAA,YACL;AAAA,UACD;AAAA,QAAA,CACA;AACD,aAAK,SAAS,IAAI;AAClB,YAAI,IAAI,SAAS;AACV,gBAAA,SAAS,MAAMA,qBAA8C;AAAA,YAClE,KAAK,GAAG,GAAG;AAAA,YACX,MAAM;AAAA,cACL,SAAS,IAAI,KAAK;AAAA,cAClB,SAAS;AAAA,gBACR,WAAW;AAAA;AAAA,gBACX,YAAY;AAAA;AAAA,cACb;AAAA,YACD;AAAA,UAAA,CACA;AACD,cAAI,OAAO,SAAS;AACb,kBAAA,YAAYC,cAAAA,aAAa,OAAO,MAAM;AAAA,cAC3C,aAAa;AAAA,cACb,eAAe;AAAA,gBACd,QAAQ;AAAA,gBACR,QAAQ;AAAA,cACT;AAAA,cACA,mBAAmB;AAAA,cACnB,qBAAqB;AAAA;AAAA,YAAA,CACrB;AACD,iBAAK,gBAAgB;AACrB,iBAAK,OAAO;AAAA,UAAA,OACN;AACN,iBAAK,OAAO;AAAA,UACb;AAAA,QACD;AAAA,MAAA,QACO;AACP,aAAK,gBAAgB;AAAA,MACtB;AAAA,IACD;AAAA,EACD;AAAA,EACA,SAAS;AAAA;AAAA;AAAA,EAGT;AACD,CAAC;;"}