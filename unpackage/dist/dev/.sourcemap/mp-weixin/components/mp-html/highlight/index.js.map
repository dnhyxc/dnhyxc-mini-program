{"version":3,"file":"index.js","sources":["components/mp-html/highlight/index.js"],"sourcesContent":["/**\r\n * @fileoverview highlight 插件\r\n * Include prismjs (https://prismjs.com)\r\n */\r\nimport prism from './prism.min'\r\nimport config from './config'\r\nimport Parser from '../parser'\r\n\r\nfunction Highlight (vm) {\r\n  this.vm = vm\r\n}\r\n\r\nHighlight.prototype.onParse = function (node, vm) {\r\n  if (node.name === 'pre') {\r\n    if (vm.options.editable) {\r\n      node.attrs.class = (node.attrs.class || '') + ' hl-pre'\r\n      return\r\n    }\r\n    let i\r\n    for (i = node.children.length; i--;) {\r\n      if (node.children[i].name === 'code') break\r\n    }\r\n    if (i === -1) return\r\n    const code = node.children[i]\r\n    let className = code.attrs.class + ' ' + node.attrs.class\r\n    i = className.indexOf('language-')\r\n    if (i === -1) {\r\n      i = className.indexOf('lang-')\r\n      if (i === -1) {\r\n        className = 'language-text'\r\n        i = 9\r\n      } else {\r\n        i += 5\r\n      }\r\n    } else {\r\n      i += 9\r\n    }\r\n    let j\r\n    for (j = i; j < className.length; j++) {\r\n      if (className[j] === ' ') break\r\n    }\r\n    const lang = className.substring(i, j)\r\n    if (code.children.length) {\r\n      const text = this.vm.getText(code.children).replace(/&amp;/g, '&')\r\n      if (!text) return\r\n      if (node.c) {\r\n        node.c = undefined\r\n      }\r\n      if (prism.languages[lang]) {\r\n        code.children = (new Parser(this.vm).parse(\r\n          // 加一层 pre 保留空白符\r\n          '<pre>' + prism.highlight(text, prism.languages[lang], lang).replace(/token /g, 'hl-') + '</pre>'))[0].children\r\n      }\r\n      node.attrs.class = 'hl-pre'\r\n      code.attrs.class = 'hl-code'\r\n      if (config.showLanguageName) {\r\n        node.children.push({\r\n          name: 'div',\r\n          attrs: {\r\n            class: 'hl-language',\r\n            style: 'user-select:none'\r\n          },\r\n          children: [{\r\n            type: 'text',\r\n            text: lang\r\n          }]\r\n        })\r\n      }\r\n      if (config.copyByLongPress) {\r\n        node.attrs.style += (node.attrs.style || '') + ';user-select:none'\r\n        node.attrs['data-content'] = text\r\n        vm.expose()\r\n      }\r\n      if (config.showLineNumber) {\r\n        const line = text.split('\\n').length; const children = []\r\n        for (let k = line; k--;) {\r\n          children.push({\r\n            name: 'span',\r\n            attrs: {\r\n              class: 'span'\r\n            }\r\n          })\r\n        }\r\n        node.children.push({\r\n          name: 'span',\r\n          attrs: {\r\n            class: 'line-numbers-rows'\r\n          },\r\n          children\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default Highlight\r\n"],"names":["prism","Parser"],"mappings":";;;AAQA,SAAS,UAAW,IAAI;AACtB,OAAK,KAAK;AACZ;AAEA,UAAU,UAAU,UAAU,SAAU,MAAM,IAAI;AAChD,MAAI,KAAK,SAAS,OAAO;AACvB,QAAI,GAAG,QAAQ,UAAU;AACvB,WAAK,MAAM,SAAS,KAAK,MAAM,SAAS,MAAM;AAC9C;AAAA,IACD;AACD,QAAI;AACJ,SAAK,IAAI,KAAK,SAAS,QAAQ,OAAM;AACnC,UAAI,KAAK,SAAS,CAAC,EAAE,SAAS;AAAQ;AAAA,IACvC;AACD,QAAI,MAAM;AAAI;AACd,UAAM,OAAO,KAAK,SAAS,CAAC;AAC5B,QAAI,YAAY,KAAK,MAAM,QAAQ,MAAM,KAAK,MAAM;AACpD,QAAI,UAAU,QAAQ,WAAW;AACjC,QAAI,MAAM,IAAI;AACZ,UAAI,UAAU,QAAQ,OAAO;AAC7B,UAAI,MAAM,IAAI;AACZ,oBAAY;AACZ,YAAI;AAAA,MACZ,OAAa;AACL,aAAK;AAAA,MACN;AAAA,IACP,OAAW;AACL,WAAK;AAAA,IACN;AACD,QAAI;AACJ,SAAK,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACrC,UAAI,UAAU,CAAC,MAAM;AAAK;AAAA,IAC3B;AACD,UAAM,OAAO,UAAU,UAAU,GAAG,CAAC;AACrC,QAAI,KAAK,SAAS,QAAQ;AACxB,YAAM,OAAO,KAAK,GAAG,QAAQ,KAAK,QAAQ,EAAE,QAAQ,UAAU,GAAG;AACjE,UAAI,CAAC;AAAM;AACX,UAAI,KAAK,GAAG;AACV,aAAK,IAAI;AAAA,MACV;AACD,UAAIA,sCAAK,MAAC,UAAU,IAAI,GAAG;AACzB,aAAK,WAAY,IAAIC,yBAAM,OAAC,KAAK,EAAE,EAAE;AAAA;AAAA,UAEnC,UAAUD,sCAAK,MAAC,UAAU,MAAMA,sCAAK,MAAC,UAAU,IAAI,GAAG,IAAI,EAAE,QAAQ,WAAW,KAAK,IAAI;AAAA,QAAQ,EAAG,CAAC,EAAE;AAAA,MAC1G;AACD,WAAK,MAAM,QAAQ;AACnB,WAAK,MAAM,QAAQ;AAAA,IAqCpB;AAAA,EACF;AACH;;"}