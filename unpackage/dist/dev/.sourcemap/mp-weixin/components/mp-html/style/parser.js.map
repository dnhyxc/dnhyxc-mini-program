{"version":3,"file":"parser.js","sources":["components/mp-html/style/parser.js"],"sourcesContent":["const blank = {\r\n  ' ': true,\r\n  '\\n': true,\r\n  '\\t': true,\r\n  '\\r': true,\r\n  '\\f': true\r\n}\r\n\r\nfunction Parser () {\r\n  this.styles = []\r\n  this.selectors = []\r\n}\r\n\r\n/**\r\n * @description 解析 css 字符串\r\n * @param {string} content css 内容\r\n */\r\nParser.prototype.parse = function (content) {\r\n  new Lexer(this).parse(content)\r\n  return this.styles\r\n}\r\n\r\n/**\r\n * @description 解析到一个选择器\r\n * @param {string} name 名称\r\n */\r\nParser.prototype.onSelector = function (name) {\r\n  // 不支持的选择器\r\n  if (name.includes('[') || name.includes('*') || name.includes('@')) return\r\n  const selector = {}\r\n  // 伪类\r\n  if (name.includes(':')) {\r\n    const info = name.split(':')\r\n    const pseudo = info.pop()\r\n    if (pseudo === 'before' || pseudo === 'after') {\r\n      selector.pseudo = pseudo\r\n      name = info[0]\r\n    } else return\r\n  }\r\n\r\n  // 分割交集选择器\r\n  function splitItem (str) {\r\n    const arr = []\r\n    let i, start\r\n    for (i = 1, start = 0; i < str.length; i++) {\r\n      if (str[i] === '.' || str[i] === '#') {\r\n        arr.push(str.substring(start, i))\r\n        start = i\r\n      }\r\n    }\r\n    if (!arr.length) {\r\n      return str\r\n    } else {\r\n      arr.push(str.substring(start, i))\r\n      return arr\r\n    }\r\n  }\r\n\r\n  // 后代选择器\r\n  if (name.includes(' ')) {\r\n    selector.list = []\r\n    const list = name.split(' ')\r\n    for (let i = 0; i < list.length; i++) {\r\n      if (list[i].length) {\r\n        // 拆分子选择器\r\n        const arr = list[i].split('>')\r\n        for (let j = 0; j < arr.length; j++) {\r\n          selector.list.push(splitItem(arr[j]))\r\n          if (j < arr.length - 1) {\r\n            selector.list.push('>')\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    selector.key = splitItem(name)\r\n  }\r\n\r\n  this.selectors.push(selector)\r\n}\r\n\r\n/**\r\n * @description 解析到选择器内容\r\n * @param {string} content 内容\r\n */\r\nParser.prototype.onContent = function (content) {\r\n  // 并集选择器\r\n  for (let i = 0; i < this.selectors.length; i++) {\r\n    this.selectors[i].style = content\r\n  }\r\n  this.styles = this.styles.concat(this.selectors)\r\n  this.selectors = []\r\n}\r\n\r\n/**\r\n * @description css 词法分析器\r\n * @param {object} handler 高层处理器\r\n */\r\nfunction Lexer (handler) {\r\n  this.selector = ''\r\n  this.style = ''\r\n  this.handler = handler\r\n}\r\n\r\nLexer.prototype.parse = function (content) {\r\n  this.i = 0\r\n  this.content = content\r\n  this.state = this.blank\r\n  for (let len = content.length; this.i < len; this.i++) {\r\n    this.state(content[this.i])\r\n  }\r\n}\r\n\r\nLexer.prototype.comment = function () {\r\n  this.i = this.content.indexOf('*/', this.i) + 1\r\n  if (!this.i) {\r\n    this.i = this.content.length\r\n  }\r\n}\r\n\r\nLexer.prototype.blank = function (c) {\r\n  if (!blank[c]) {\r\n    if (c === '/' && this.content[this.i + 1] === '*') {\r\n      this.comment()\r\n      return\r\n    }\r\n    this.selector += c\r\n    this.state = this.name\r\n  }\r\n}\r\n\r\nLexer.prototype.name = function (c) {\r\n  if (c === '/' && this.content[this.i + 1] === '*') {\r\n    this.comment()\r\n    return\r\n  }\r\n  if (c === '{' || c === ',' || c === ';') {\r\n    this.handler.onSelector(this.selector.trimEnd())\r\n    this.selector = ''\r\n    if (c !== '{') {\r\n      while (blank[this.content[++this.i]]);\r\n    }\r\n    if (this.content[this.i] === '{') {\r\n      this.floor = 1\r\n      this.state = this.val\r\n    } else {\r\n      this.selector += this.content[this.i]\r\n    }\r\n  } else if (blank[c]) {\r\n    this.selector += ' '\r\n  } else {\r\n    this.selector += c\r\n  }\r\n}\r\n\r\nLexer.prototype.val = function (c) {\r\n  if (c === '/' && this.content[this.i + 1] === '*') {\r\n    this.comment()\r\n    return\r\n  }\r\n  if (c === '{') {\r\n    this.floor++\r\n  } else if (c === '}') {\r\n    this.floor--\r\n    if (!this.floor) {\r\n      this.handler.onContent(this.style)\r\n      this.style = ''\r\n      this.state = this.blank\r\n      return\r\n    }\r\n  }\r\n  this.style += c\r\n}\r\n\r\nexport default Parser\r\n"],"names":[],"mappings":"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"}